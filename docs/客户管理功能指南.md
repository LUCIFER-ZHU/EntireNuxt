# 客户管理功能开发指南

## 功能概述

已完成完整的前后端联动客户表格系统，包含增删改查功能。

## 文件结构

```
EntireNuxt/
├── prisma/
│   └── schema.prisma          # 客户模型定义
├── server/
│   └── api/
│       └── customers/
│           ├── index.get.ts   # 列表查询（分页/搜索）
│           ├── index.post.ts  # 创建客户
│           ├── [id].get.ts    # 详情查询
│           ├── [id].put.ts    # 更新客户
│           └── [id].delete.ts # 删除客户
├── app/
│   ├── api/
│   │   └── customers.ts       # 前端 API 封装
│   └── pages/
│       └── customers/
│           └── index.vue      # 客户管理页面
└── docs/
    └── 客户管理功能指南.md     # 本指南
```

## 数据模型

### Customer 模型

| 字段 | 类型 | 说明 |
|------|------|------|
| id | UUID | 主键 |
| name | String | 客户姓名（必填） |
| email | String? | 邮箱 |
| phone | String? | 电话 |
| company | String? | 公司名称 |
| address | String? | 详细地址 |
| level | CustomerLevel | 等级：VIP/GOLD/SILVER/BRONZE/REGULAR |
| status | CustomerStatus | 状态：ACTIVE/INACTIVE/POTENTIAL/LOST |
| source | String? | 客户来源 |
| industry | String? | 所属行业 |
| notes | String? | 备注 |
| assignedTo | UUID? | 分配的业务员ID |
| createdAt | DateTime | 创建时间 |
| updatedAt | DateTime | 更新时间 |

## API 接口

### 1. 获取客户列表
```http
GET /api/customers?page=1&pageSize=10&keyword=张三&level=VIP
```

**查询参数：**
- `page`: 页码（默认1）
- `pageSize`: 每页数量（默认10）
- `keyword`: 搜索关键词（搜索姓名、邮箱、电话、公司）
- `level`: 等级筛选
- `status`: 状态筛选
- `industry`: 行业筛选
- `sortBy`: 排序字段（createdAt/name/level/status）
- `sortOrder`: 排序方向（asc/desc）

**响应：**
```json
{
  "success": true,
  "data": [...],
  "pagination": {
    "page": 1,
    "pageSize": 10,
    "total": 100,
    "totalPages": 10
  }
}
```

### 2. 获取客户详情
```http
GET /api/customers/:id
```

### 3. 创建客户
```http
POST /api/customers
Content-Type: application/json

{
  "name": "张三",
  "email": "zhangsan@example.com",
  "phone": "13800138000",
  "company": "ABC公司",
  "level": "VIP",
  "status": "ACTIVE"
}
```

### 4. 更新客户
```http
PUT /api/customers/:id
Content-Type: application/json

{
  "name": "张三（已修改）",
  "level": "GOLD"
}
```

### 5. 删除客户
```http
DELETE /api/customers/:id
```

## 前端使用示例

### 获取客户列表
```typescript
import { getCustomers } from '~/api/customers'

const { customers, pagination } = await getCustomers({
  page: 1,
  pageSize: 10,
  keyword: '张三',
  level: 'VIP'
})
```

### 创建客户
```typescript
import { createCustomer } from '~/api/customers'

const customer = await createCustomer({
  name: '张三',
  email: 'zhangsan@example.com',
  phone: '13800138000',
  company: 'ABC公司',
  level: 'VIP',
  status: 'ACTIVE'
})
```

### 更新客户
```typescript
import { updateCustomer } from '~/api/customers'

const customer = await updateCustomer('customer-id', {
  name: '张三（已修改）',
  level: 'GOLD'
})
```

### 删除客户
```typescript
import { deleteCustomer } from '~/api/customers'

await deleteCustomer('customer-id')
```

## 页面功能

访问 `/customers` 路径查看客户管理页面：

### 功能特性
- ✅ 客户列表展示（分页）
- ✅ 关键词搜索（姓名、邮箱、电话、公司）
- ✅ 等级筛选（VIP/金牌/银牌/铜牌/普通）
- ✅ 状态筛选（活跃/Inactive/潜在客户/流失）
- ✅ 新增客户（模态框表单）
- ✅ 编辑客户（模态框表单）
- ✅ 删除客户（确认对话框）
- ✅ 响应式布局（支持移动端）

## 下一步操作

### 1. 配置数据库连接
编辑 `.env.development`，填入你的 Supabase 连接字符串：
```env
DATABASE_URL="postgresql://postgres.xxx:password@aws-0-region.pooler.supabase.com:6543/postgres"
```

### 2. 运行数据库迁移
```bash
# 方式1：使用 package.json 脚本
pnpm db:migrate

# 方式2：直接运行
npx prisma migrate dev --name add_customer
```

### 3. 启动开发服务器
```bash
pnpm dev
```

### 4. 访问页面
打开浏览器访问：`http://localhost:3000/customers`

## 测试 API

使用 curl 测试：

```bash
# 创建客户
curl -X POST http://localhost:3000/api/customers \
  -H "Content-Type: application/json" \
  -d '{
    "name": "测试客户",
    "email": "test@example.com",
    "phone": "13800138000",
    "company": "测试公司",
    "level": "VIP",
    "status": "ACTIVE"
  }'

# 获取列表
curl "http://localhost:3000/api/customers?page=1&pageSize=10"
```

## 扩展建议

1. **权限控制**：添加管理员/业务员权限验证
2. **数据导出**：添加 Excel/CSV 导出功能
3. **批量操作**：支持批量删除、批量修改状态
4. **客户跟进**：添加跟进记录表
5. **数据统计**：添加客户统计图表
